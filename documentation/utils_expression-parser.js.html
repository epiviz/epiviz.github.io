<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: utils/expression-parser.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: utils/expression-parser.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Created by Florin Chelaru ( florinc [at] umd [dot] edu )
 * Date: 2/25/14
 * Time: 10:37 PM
 */

/*
 Based on ndef.parser, by Raphael Graf(r@undefined.ch)
 http://www.undefined.ch/mparser/index.html

 Ported to JavaScript and modified by Matthew Crumley (email@matthewcrumley.com, http://silentmatt.com/)

 You are free to use and modify this code in anyway you find useful. Please leave this comment in the code
 to acknowledge its original source. If you feel like it, I enjoy hearing about projects that use my code,
 but don't feel like you have to let me know or ask permission.
 */

//  Added by stlsmiths 6/13/2011
//  re-define Array.indexOf, because IE doesn't know it ...
//
//  from http://stellapower.net/content/javascript-support-and-arrayindexof-ie
if (!Array.indexOf) {
  Array.prototype.indexOf = function (obj, start) {
    for (var i = (start || 0); i &lt; this.length; i++) {
      if (this[i] === obj) {
        return i;
      }
    }
    return -1;
  }
}

goog.provide('epiviz.utils.ExpressionParser');

epiviz.utils.ExpressionParser = (function (scope) {
  function object(o) {
    function F() {}
    F.prototype = o;
    return new F();
  }

  var TNUMBER = 0;
  var TOP1 = 1;
  var TOP2 = 2;
  var TVAR = 3;
  var TFUNCALL = 4;

  function Token(type_, index_, prio_, number_) {
    this.type_ = type_;
    this.index_ = index_ || 0;
    this.prio_ = prio_ || 0;
    this.number_ = (number_ !== undefined &amp;&amp; number_ !== null) ? number_ : 0;
    this.toString = function () {
      switch (this.type_) {
        case TNUMBER:
          return this.number_;
        case TOP1:
        case TOP2:
        case TVAR:
          return this.index_;
        case TFUNCALL:
          return "CALL";
        default:
          return "Invalid Token";
      }
    };
  }

  function Expression(tokens, ops1, ops2, functions) {
    this.tokens = tokens;
    this.ops1 = ops1;
    this.ops2 = ops2;
    this.functions = functions;
  }

  // Based on http://www.json.org/json2.js
  var cx = /[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
    escapable = /[\\\'\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
    meta = {    // table of character substitutions
      '\b': '\\b',
      '\t': '\\t',
      '\n': '\\n',
      '\f': '\\f',
      '\r': '\\r',
      "'" : "\\'",
      '\\': '\\\\'
    };

  function escapeValue(v) {
    if (typeof v === "string") {
      escapable.lastIndex = 0;
      return escapable.test(v) ?
        "'" + v.replace(escapable, function (a) {
          var c = meta[a];
          return typeof c === 'string' ? c :
            '\\u' + ('0000' + a.charCodeAt(0).toString(16)).slice(-4);
        }) + "'" :
        "'" + v + "'";
    }
    return v;
  }

  Expression.prototype = {
    simplify: function (values) {
      values = values || {};
      var nstack = [];
      var newexpression = [];
      var n1;
      var n2;
      var f;
      var L = this.tokens.length;
      var item;
      var i = 0;
      for (i = 0; i &lt; L; i++) {
        item = this.tokens[i];
        var type_ = item.type_;
        if (type_ === TNUMBER) {
          nstack.push(item);
        }
        else if (type_ === TVAR &amp;&amp; (item.index_ in values)) {
          item = new Token(TNUMBER, 0, 0, values[item.index_]);
          nstack.push(item);
        }
        else if (type_ === TOP2 &amp;&amp; nstack.length > 1) {
          n2 = nstack.pop();
          n1 = nstack.pop();
          f = this.ops2[item.index_];
          item = new Token(TNUMBER, 0, 0, f(n1.number_, n2.number_));
          nstack.push(item);
        }
        else if (type_ === TOP1 &amp;&amp; nstack.length > 0) {
          n1 = nstack.pop();
          f = this.ops1[item.index_];
          item = new Token(TNUMBER, 0, 0, f(n1.number_));
          nstack.push(item);
        }
        else {
          while (nstack.length > 0) {
            newexpression.push(nstack.shift());
          }
          newexpression.push(item);
        }
      }
      while (nstack.length > 0) {
        newexpression.push(nstack.shift());
      }

      return new Expression(newexpression, object(this.ops1), object(this.ops2), object(this.functions));
    },

    substitute: function (variable, expr) {
      if (!(expr instanceof Expression)) {
        expr = new Parser().parse(String(expr));
      }
      var newexpression = [];
      var L = this.tokens.length;
      var item;
      var i = 0;
      for (i = 0; i &lt; L; i++) {
        item = this.tokens[i];
        var type_ = item.type_;
        if (type_ === TVAR &amp;&amp; item.index_ === variable) {
          for (var j = 0; j &lt; expr.tokens.length; j++) {
            var expritem = expr.tokens[j];
            var replitem = new Token(expritem.type_, expritem.index_, expritem.prio_, expritem.number_);
            newexpression.push(replitem);
          }
        }
        else {
          newexpression.push(item);
        }
      }

      var ret = new Expression(newexpression, object(this.ops1), object(this.ops2), object(this.functions));
      return ret;
    },

    /**
     * @param {Object.&lt;string, number>} values
     * @returns {number}
     */
    evaluate: function (values) {
      values = values || {};
      var nstack = [];
      var n1;
      var n2;
      var f;
      var L = this.tokens.length;
      var item;
      var i = 0;
      for (i = 0; i &lt; L; i++) {
        item = this.tokens[i];
        var type_ = item.type_;
        if (type_ === TNUMBER) {
          nstack.push(item.number_);
        }
        else if (type_ === TOP2) {
          n2 = nstack.pop();
          n1 = nstack.pop();
          f = this.ops2[item.index_];
          nstack.push(f(n1, n2));
        }
        else if (type_ === TVAR) {
          if (item.index_ in values) {
            nstack.push(values[item.index_]);
          }
          else if (item.index_ in this.functions) {
            nstack.push(this.functions[item.index_]);
          }
          else {
            throw new Error("undefined variable: " + item.index_);
          }
        }
        else if (type_ === TOP1) {
          n1 = nstack.pop();
          f = this.ops1[item.index_];
          nstack.push(f(n1));
        }
        else if (type_ === TFUNCALL) {
          n1 = nstack.pop();
          f = nstack.pop();
          if (f.apply &amp;&amp; f.call) {
            if (Object.prototype.toString.call(n1) == "[object Array]") {
              nstack.push(f.apply(undefined, n1));
            }
            else {
              nstack.push(f.call(undefined, n1));
            }
          }
          else {
            throw new Error(f + " is not a function");
          }
        }
        else {
          throw new Error("invalid Expression");
        }
      }
      if (nstack.length > 1) {
        throw new Error("invalid Expression (parity)");
      }
      return nstack[0];
    },

    /**
     * Evaluates the expression for each of the tuple of values in the given arrays
     * @param {Object.&lt;string, Array.&lt;number>>} values
     * @returns {Array.&lt;number>}
     */
    evaluateArr: function(values) {
      var result = [];
      var finished = false;
      while (!finished) {
        var tuple = {};
        for (var v in values) {
          if (!values.hasOwnProperty(v)) { continue; }
          if (result.length >= values[v].length) {
            finished = true;
            break;
          }

          tuple[v] = values[v][result.length];
        }

        if (!finished) {
          result.push(this.evaluate(tuple));
        }
      }

      return result;
    },

    toString: function (toJS) {
      var nstack = [];
      var n1;
      var n2;
      var f;
      var L = this.tokens.length;
      var item;
      var i = 0;
      for (i = 0; i &lt; L; i++) {
        item = this.tokens[i];
        var type_ = item.type_;
        if (type_ === TNUMBER) {
          nstack.push(escapeValue(item.number_));
        }
        else if (type_ === TOP2) {
          n2 = nstack.pop();
          n1 = nstack.pop();
          f = item.index_;
          if (toJS &amp;&amp; f == "^") {
            nstack.push("Math.pow(" + n1 + "," + n2 + ")");
          }
          else {
            nstack.push("(" + n1 + f + n2 + ")");
          }
        }
        else if (type_ === TVAR) {
          nstack.push(item.index_);
        }
        else if (type_ === TOP1) {
          n1 = nstack.pop();
          f = item.index_;
          if (f === "-") {
            nstack.push("(" + f + n1 + ")");
          }
          else {
            nstack.push(f + "(" + n1 + ")");
          }
        }
        else if (type_ === TFUNCALL) {
          n1 = nstack.pop();
          f = nstack.pop();
          nstack.push(f + "(" + n1 + ")");
        }
        else {
          throw new Error("invalid Expression");
        }
      }
      if (nstack.length > 1) {
        throw new Error("invalid Expression (parity)");
      }
      return nstack[0];
    },

    variables: function () {
      var L = this.tokens.length;
      var vars = [];
      for (var i = 0; i &lt; L; i++) {
        var item = this.tokens[i];
        if (item.type_ === TVAR &amp;&amp; (vars.indexOf(item.index_) == -1)) {
          vars.push(item.index_);
        }
      }

      return vars;
    },

    toJSFunction: function (param, variables) {
      var f = new Function(param, "with(Parser.values) { return " + this.simplify(variables).toString(true) + "; }");
      return f;
    }
  };

  function add(a, b) {
    return Number(a) + Number(b);
  }
  function sub(a, b) {
    return a - b;
  }
  function mul(a, b) {
    return a * b;
  }
  function div(a, b) {
    return a / b;
  }
  function mod(a, b) {
    return a % b;
  }
  function concat(a, b) {
    return "" + a + b;
  }

  function neg(a) {
    return -a;
  }

  function random(a) {
    return Math.random() * (a || 1);
  }
  function fac(a) { //a!
    a = Math.floor(a);
    var b = a;
    while (a > 1) {
      b = b * (--a);
    }
    return b;
  }

  // TODO: use hypot that doesn't overflow
  function pyt(a, b) {
    return Math.sqrt(a * a + b * b);
  }

  function append(a, b) {
    if (Object.prototype.toString.call(a) != "[object Array]") {
      return [a, b];
    }
    a = a.slice();
    a.push(b);
    return a;
  }

  function Parser() {
    this.success = false;
    this.errormsg = "";
    this.expression = "";

    this.pos = 0;

    this.tokennumber = 0;
    this.tokenprio = 0;
    this.tokenindex = 0;
    this.tmpprio = 0;

    this.ops1 = {
      "sin": Math.sin,
      "cos": Math.cos,
      "tan": Math.tan,
      "asin": Math.asin,
      "acos": Math.acos,
      "atan": Math.atan,
      "sqrt": Math.sqrt,
      "log": Math.log,
      "abs": Math.abs,
      "ceil": Math.ceil,
      "floor": Math.floor,
      "round": Math.round,
      "-": neg,
      "exp": Math.exp
    };

    this.ops2 = {
      "+": add,
      "-": sub,
      "*": mul,
      "/": div,
      "%": mod,
      "^": Math.pow,
      ",": append,
      "||": concat
    };

    this.functions = {
      "random": random,
      "fac": fac,
      "min": Math.min,
      "max": Math.max,
      "pyt": pyt,
      "pow": Math.pow,
      "atan2": Math.atan2
    };

    this.consts = {
      "E": Math.E,
      "PI": Math.PI
    };
  }

  Parser.parse = function (expr) {
    return new Parser().parse(expr);
  };

  Parser.evaluate = function (expr, variables) {
    return Parser.parse(expr).evaluate(variables);
  };

  Parser.Expression = Expression;

  Parser.values = {
    sin: Math.sin,
    cos: Math.cos,
    tan: Math.tan,
    asin: Math.asin,
    acos: Math.acos,
    atan: Math.atan,
    sqrt: Math.sqrt,
    log: Math.log,
    abs: Math.abs,
    ceil: Math.ceil,
    floor: Math.floor,
    round: Math.round,
    random: random,
    fac: fac,
    exp: Math.exp,
    min: Math.min,
    max: Math.max,
    pyt: pyt,
    pow: Math.pow,
    atan2: Math.atan2,
    E: Math.E,
    PI: Math.PI
  };

  var PRIMARY      = 1 &lt;&lt; 0;
  var OPERATOR     = 1 &lt;&lt; 1;
  var FUNCTION     = 1 &lt;&lt; 2;
  var LPAREN       = 1 &lt;&lt; 3;
  var RPAREN       = 1 &lt;&lt; 4;
  var COMMA        = 1 &lt;&lt; 5;
  var SIGN         = 1 &lt;&lt; 6;
  var CALL         = 1 &lt;&lt; 7;
  var NULLARY_CALL = 1 &lt;&lt; 8;

  Parser.prototype = {
    parse: function (expr) {
      this.errormsg = "";
      this.success = true;
      var operstack = [];
      var tokenstack = [];
      this.tmpprio = 0;
      var expected = (PRIMARY | LPAREN | FUNCTION | SIGN);
      var noperators = 0;
      this.expression = expr;
      this.pos = 0;

      while (this.pos &lt; this.expression.length) {
        if (this.isOperator()) {
          if (this.isSign() &amp;&amp; (expected &amp; SIGN)) {
            if (this.isNegativeSign()) {
              this.tokenprio = 2;
              this.tokenindex = "-";
              noperators++;
              this.addfunc(tokenstack, operstack, TOP1);
            }
            expected = (PRIMARY | LPAREN | FUNCTION | SIGN);
          }
          else if (this.isComment()) {

          }
          else {
            if ((expected &amp; OPERATOR) === 0) {
              this.error_parsing(this.pos, "unexpected operator");
            }
            noperators += 2;
            this.addfunc(tokenstack, operstack, TOP2);
            expected = (PRIMARY | LPAREN | FUNCTION | SIGN);
          }
        }
        else if (this.isNumber()) {
          if ((expected &amp; PRIMARY) === 0) {
            this.error_parsing(this.pos, "unexpected number");
          }
          var token = new Token(TNUMBER, 0, 0, this.tokennumber);
          tokenstack.push(token);

          expected = (OPERATOR | RPAREN | COMMA);
        }
        else if (this.isString()) {
          if ((expected &amp; PRIMARY) === 0) {
            this.error_parsing(this.pos, "unexpected string");
          }
          var token = new Token(TNUMBER, 0, 0, this.tokennumber);
          tokenstack.push(token);

          expected = (OPERATOR | RPAREN | COMMA);
        }
        else if (this.isLeftParenth()) {
          if ((expected &amp; LPAREN) === 0) {
            this.error_parsing(this.pos, "unexpected \"(\"");
          }

          if (expected &amp; CALL) {
            noperators += 2;
            this.tokenprio = -2;
            this.tokenindex = -1;
            this.addfunc(tokenstack, operstack, TFUNCALL);
          }

          expected = (PRIMARY | LPAREN | FUNCTION | SIGN | NULLARY_CALL);
        }
        else if (this.isRightParenth()) {
          if (expected &amp; NULLARY_CALL) {
            var token = new Token(TNUMBER, 0, 0, []);
            tokenstack.push(token);
          }
          else if ((expected &amp; RPAREN) === 0) {
            this.error_parsing(this.pos, "unexpected \")\"");
          }

          expected = (OPERATOR | RPAREN | COMMA | LPAREN | CALL);
        }
        else if (this.isComma()) {
          if ((expected &amp; COMMA) === 0) {
            this.error_parsing(this.pos, "unexpected \",\"");
          }
          this.addfunc(tokenstack, operstack, TOP2);
          noperators += 2;
          expected = (PRIMARY | LPAREN | FUNCTION | SIGN);
        }
        else if (this.isConst()) {
          if ((expected &amp; PRIMARY) === 0) {
            this.error_parsing(this.pos, "unexpected constant");
          }
          var consttoken = new Token(TNUMBER, 0, 0, this.tokennumber);
          tokenstack.push(consttoken);
          expected = (OPERATOR | RPAREN | COMMA);
        }
        else if (this.isOp2()) {
          if ((expected &amp; FUNCTION) === 0) {
            this.error_parsing(this.pos, "unexpected function");
          }
          this.addfunc(tokenstack, operstack, TOP2);
          noperators += 2;
          expected = (LPAREN);
        }
        else if (this.isOp1()) {
          if ((expected &amp; FUNCTION) === 0) {
            this.error_parsing(this.pos, "unexpected function");
          }
          this.addfunc(tokenstack, operstack, TOP1);
          noperators++;
          expected = (LPAREN);
        }
        else if (this.isVar()) {
          if ((expected &amp; PRIMARY) === 0) {
            this.error_parsing(this.pos, "unexpected variable");
          }
          var vartoken = new Token(TVAR, this.tokenindex, 0, 0);
          tokenstack.push(vartoken);

          expected = (OPERATOR | RPAREN | COMMA | LPAREN | CALL);
        }
        else if (this.isWhite()) {
        }
        else {
          if (this.errormsg === "") {
            this.error_parsing(this.pos, "unknown character");
          }
          else {
            this.error_parsing(this.pos, this.errormsg);
          }
        }
      }
      if (this.tmpprio &lt; 0 || this.tmpprio >= 10) {
        this.error_parsing(this.pos, "unmatched \"()\"");
      }
      while (operstack.length > 0) {
        var tmp = operstack.pop();
        tokenstack.push(tmp);
      }
      if (noperators + 1 !== tokenstack.length) {
        //print(noperators + 1);
        //print(tokenstack);
        this.error_parsing(this.pos, "parity");
      }

      return new Expression(tokenstack, object(this.ops1), object(this.ops2), object(this.functions));
    },

    evaluate: function (expr, variables) {
      return this.parse(expr).evaluate(variables);
    },

    error_parsing: function (column, msg) {
      this.success = false;
      this.errormsg = "parse error [column " + (column) + "]: " + msg;
      throw new Error(this.errormsg);
    },

//\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\

    addfunc: function (tokenstack, operstack, type_) {
      var operator = new Token(type_, this.tokenindex, this.tokenprio + this.tmpprio, 0);
      while (operstack.length > 0) {
        if (operator.prio_ &lt;= operstack[operstack.length - 1].prio_) {
          tokenstack.push(operstack.pop());
        }
        else {
          break;
        }
      }
      operstack.push(operator);
    },

    isNumber: function () {
      var r = false;
      var str = "";
      while (this.pos &lt; this.expression.length) {
        var code = this.expression.charCodeAt(this.pos);
        if ((code >= 48 &amp;&amp; code &lt;= 57) || code === 46) {
          str += this.expression.charAt(this.pos);
          this.pos++;
          this.tokennumber = parseFloat(str);
          r = true;
        }
        else {
          break;
        }
      }
      return r;
    },

    // Ported from the yajjl JSON parser at http://code.google.com/p/yajjl/
    unescape: function(v, pos) {
      var buffer = [];
      var escaping = false;

      for (var i = 0; i &lt; v.length; i++) {
        var c = v.charAt(i);

        if (escaping) {
          switch (c) {
            case "'":
              buffer.push("'");
              break;
            case '\\':
              buffer.push('\\');
              break;
            case '/':
              buffer.push('/');
              break;
            case 'b':
              buffer.push('\b');
              break;
            case 'f':
              buffer.push('\f');
              break;
            case 'n':
              buffer.push('\n');
              break;
            case 'r':
              buffer.push('\r');
              break;
            case 't':
              buffer.push('\t');
              break;
            case 'u':
              // interpret the following 4 characters as the hex of the unicode code point
              var codePoint = parseInt(v.substring(i + 1, i + 5), 16);
              buffer.push(String.fromCharCode(codePoint));
              i += 4;
              break;
            default:
              throw this.error_parsing(pos + i, "Illegal escape sequence: '\\" + c + "'");
          }
          escaping = false;
        } else {
          if (c == '\\') {
            escaping = true;
          } else {
            buffer.push(c);
          }
        }
      }

      return buffer.join('');
    },

    isString: function () {
      var r = false;
      var str = "";
      var startpos = this.pos;
      if (this.pos &lt; this.expression.length &amp;&amp; this.expression.charAt(this.pos) == "'") {
        this.pos++;
        while (this.pos &lt; this.expression.length) {
          var code = this.expression.charAt(this.pos);
          if (code != "'" || str.slice(-1) == "\\") {
            str += this.expression.charAt(this.pos);
            this.pos++;
          }
          else {
            this.pos++;
            this.tokennumber = this.unescape(str, startpos);
            r = true;
            break;
          }
        }
      }
      return r;
    },

    isConst: function () {
      var str;
      for (var i in this.consts) {
        if (true) {
          var L = i.length;
          str = this.expression.substr(this.pos, L);
          if (i === str) {
            this.tokennumber = this.consts[i];
            this.pos += L;
            return true;
          }
        }
      }
      return false;
    },

    isOperator: function () {
      var code = this.expression.charCodeAt(this.pos);
      if (code === 43) { // +
        this.tokenprio = 0;
        this.tokenindex = "+";
      }
      else if (code === 45) { // -
        this.tokenprio = 0;
        this.tokenindex = "-";
      }
      else if (code === 124) { // |
        if (this.expression.charCodeAt(this.pos + 1) === 124) {
          this.pos++;
          this.tokenprio = 0;
          this.tokenindex = "||";
        }
        else {
          return false;
        }
      }
      else if (code === 42) { // *
        this.tokenprio = 1;
        this.tokenindex = "*";
      }
      else if (code === 47) { // /
        this.tokenprio = 2;
        this.tokenindex = "/";
      }
      else if (code === 37) { // %
        this.tokenprio = 2;
        this.tokenindex = "%";
      }
      else if (code === 94) { // ^
        this.tokenprio = 3;
        this.tokenindex = "^";
      }
      else {
        return false;
      }
      this.pos++;
      return true;
    },

    isSign: function () {
      var code = this.expression.charCodeAt(this.pos - 1);
      if (code === 45 || code === 43) { // -
        return true;
      }
      return false;
    },

    isPositiveSign: function () {
      var code = this.expression.charCodeAt(this.pos - 1);
      if (code === 43) { // -
        return true;
      }
      return false;
    },

    isNegativeSign: function () {
      var code = this.expression.charCodeAt(this.pos - 1);
      if (code === 45) { // -
        return true;
      }
      return false;
    },

    isLeftParenth: function () {
      var code = this.expression.charCodeAt(this.pos);
      if (code === 40) { // (
        this.pos++;
        this.tmpprio += 10;
        return true;
      }
      return false;
    },

    isRightParenth: function () {
      var code = this.expression.charCodeAt(this.pos);
      if (code === 41) { // )
        this.pos++;
        this.tmpprio -= 10;
        return true;
      }
      return false;
    },

    isComma: function () {
      var code = this.expression.charCodeAt(this.pos);
      if (code === 44) { // ,
        this.pos++;
        this.tokenprio = -1;
        this.tokenindex = ",";
        return true;
      }
      return false;
    },

    isWhite: function () {
      var code = this.expression.charCodeAt(this.pos);
      if (code === 32 || code === 9 || code === 10 || code === 13) {
        this.pos++;
        return true;
      }
      return false;
    },

    isOp1: function () {
      var str = "";
      for (var i = this.pos; i &lt; this.expression.length; i++) {
        var c = this.expression.charAt(i);
        if (c.toUpperCase() === c.toLowerCase()) {
          if (i === this.pos || (c != '_' &amp;&amp; (c &lt; '0' || c > '9'))) {
            break;
          }
        }
        str += c;
      }
      if (str.length > 0 &amp;&amp; (str in this.ops1)) {
        this.tokenindex = str;
        this.tokenprio = 5;
        this.pos += str.length;
        return true;
      }
      return false;
    },

    isOp2: function () {
      var str = "";
      for (var i = this.pos; i &lt; this.expression.length; i++) {
        var c = this.expression.charAt(i);
        if (c.toUpperCase() === c.toLowerCase()) {
          if (i === this.pos || (c != '_' &amp;&amp; (c &lt; '0' || c > '9'))) {
            break;
          }
        }
        str += c;
      }
      if (str.length > 0 &amp;&amp; (str in this.ops2)) {
        this.tokenindex = str;
        this.tokenprio = 5;
        this.pos += str.length;
        return true;
      }
      return false;
    },

    isVar: function () {
      var str = "";
      for (var i = this.pos; i &lt; this.expression.length; i++) {
        var c = this.expression.charAt(i);
        if (c.toUpperCase() === c.toLowerCase()) {
          if (i === this.pos || (c != '_' &amp;&amp; (c &lt; '0' || c > '9'))) {
            break;
          }
        }
        str += c;
      }

      // Added by Florin Chelaru, on 2/25/2014:
      // Support variables in the form {0}
      var start = this.pos, end = this.expression.indexOf('}', this.pos);
      if (this.expression.charAt(start) == '{' &amp;&amp; end > start) {
        str = this.expression.substring(start, end + 1);
      }

      if (str.length > 0) {
        this.tokenindex = str;
        this.tokenprio = 4;
        this.pos += str.length;
        return true;
      }
      return false;
    },

    isComment: function () {
      var code = this.expression.charCodeAt(this.pos - 1);
      if (code === 47 &amp;&amp; this.expression.charCodeAt(this.pos) === 42) {
        this.pos = this.expression.indexOf("*/", this.pos) + 2;
        if (this.pos === 1) {
          this.pos = this.expression.length;
        }
        return true;
      }
      return false;
    }
  };

  scope.Parser = Parser;
  return Parser
})(typeof exports === 'undefined' ? {} : exports);

</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="epiviz.Config.html">epiviz.Config</a></li><li><a href="epiviz.data.Cache.html">epiviz.data.Cache</a></li><li><a href="epiviz.data.DataManager.html">epiviz.data.DataManager</a></li><li><a href="epiviz.data.DataProvider.html">epiviz.data.DataProvider</a></li><li><a href="epiviz.data.DataProviderFactory.html">epiviz.data.DataProviderFactory</a></li><li><a href="epiviz.data.EmptyResponseDataProvider.html">epiviz.data.EmptyResponseDataProvider</a></li><li><a href="epiviz.data.EpivizApiDataProvider.html">epiviz.data.EpivizApiDataProvider</a></li><li><a href="epiviz.data.EpivizApiDataProvider.Request.html">epiviz.data.EpivizApiDataProvider.Request</a></li><li><a href="epiviz.data.EpivizApiDataProvider.Response.html">epiviz.data.EpivizApiDataProvider.Response</a></li><li><a href="epiviz.data.MetagenomicsDataProvider.html">epiviz.data.MetagenomicsDataProvider</a></li><li><a href="epiviz.data.MockDataProvider.html">epiviz.data.MockDataProvider</a></li><li><a href="epiviz.data.Request.html">epiviz.data.Request</a></li><li><a href="epiviz.data.RequestStack.html">epiviz.data.RequestStack</a></li><li><a href="epiviz.data.Response.html">epiviz.data.Response</a></li><li><a href="epiviz.data.Response.fromRawObject.html">epiviz.data.Response.fromRawObject</a></li><li><a href="epiviz.data.WebServerDataProvider.html">epiviz.data.WebServerDataProvider</a></li><li><a href="epiviz.data.WebsocketDataProvider.html">epiviz.data.WebsocketDataProvider</a></li><li><a href="epiviz.datatypes.deprecated.GenomicRanges.html">epiviz.datatypes.deprecated.GenomicRanges</a></li><li><a href="epiviz.datatypes.deprecated.GenomicRanges.Hits.html">epiviz.datatypes.deprecated.GenomicRanges.Hits</a></li><li><a href="epiviz.datatypes.deprecated.GenomicRanges.Row.html">epiviz.datatypes.deprecated.GenomicRanges.Row</a></li><li><a href="epiviz.datatypes.deprecated.GenomicRanges.Subset.html">epiviz.datatypes.deprecated.GenomicRanges.Subset</a></li><li><a href="epiviz.datatypes.deprecated.SeqInfo.html">epiviz.datatypes.deprecated.SeqInfo</a></li><li><a href="epiviz.datatypes.FeatureValueArray.html">epiviz.datatypes.FeatureValueArray</a></li><li><a href="epiviz.datatypes.GenomicArray.html">epiviz.datatypes.GenomicArray</a></li><li><a href="epiviz.datatypes.GenomicData.ValueItem.html">epiviz.datatypes.GenomicData.ValueItem</a></li><li><a href="epiviz.datatypes.GenomicRange.html">epiviz.datatypes.GenomicRange</a></li><li><a href="epiviz.datatypes.GenomicRangeArray.html">epiviz.datatypes.GenomicRangeArray</a></li><li><a href="epiviz.datatypes.GenomicRangeArray.RowItemWrapper.html">epiviz.datatypes.GenomicRangeArray.RowItemWrapper</a></li><li><a href="epiviz.datatypes.ItemFilteredGenomicData.html">epiviz.datatypes.ItemFilteredGenomicData</a></li><li><a href="epiviz.datatypes.MapGenomicData.html">epiviz.datatypes.MapGenomicData</a></li><li><a href="epiviz.datatypes.MeasurementAggregatedGenomicData.html">epiviz.datatypes.MeasurementAggregatedGenomicData</a></li><li><a href="epiviz.datatypes.MeasurementGenomicDataArrayWrapper.html">epiviz.datatypes.MeasurementGenomicDataArrayWrapper</a></li><li><a href="epiviz.datatypes.MeasurementGenomicDataWrapper.html">epiviz.datatypes.MeasurementGenomicDataWrapper</a></li><li><a href="epiviz.datatypes.MeasurementOrderedGenomicData.html">epiviz.datatypes.MeasurementOrderedGenomicData</a></li><li><a href="epiviz.datatypes.PartialSummarizedExperiment.html">epiviz.datatypes.PartialSummarizedExperiment</a></li><li><a href="epiviz.datatypes.RowItemImpl.html">epiviz.datatypes.RowItemImpl</a></li><li><a href="epiviz.datatypes.SeqInfo.html">epiviz.datatypes.SeqInfo</a></li><li><a href="epiviz.deferred.Deferred.html">epiviz.deferred.Deferred</a></li><li><a href="epiviz.deferred.Promise.html">epiviz.deferred.Promise</a></li><li><a href="epiviz.EpiViz.html">epiviz.EpiViz</a></li><li><a href="epiviz.events.Event.html">epiviz.events.Event</a></li><li><a href="epiviz.events.EventListener.html">epiviz.events.EventListener</a></li><li><a href="epiviz.events.EventResult.html">epiviz.events.EventResult</a></li><li><a href="epiviz.localstorage.LocalStorageManager.html">epiviz.localstorage.LocalStorageManager</a></li><li><a href="epiviz.measurements.Measurement.html">epiviz.measurements.Measurement</a></li><li><a href="epiviz.measurements.MeasurementHashtable.html">epiviz.measurements.MeasurementHashtable</a></li><li><a href="epiviz.measurements.MeasurementHashtable.Iterator.html">epiviz.measurements.MeasurementHashtable.Iterator</a></li><li><a href="epiviz.measurements.MeasurementSet.html">epiviz.measurements.MeasurementSet</a></li><li><a href="epiviz.measurements.MeasurementSet.Iterator.html">epiviz.measurements.MeasurementSet.Iterator</a></li><li><a href="epiviz.measurements.MeasurementsManager.html">epiviz.measurements.MeasurementsManager</a></li><li><a href="epiviz.plugins.charts.BlocksTrack.html">epiviz.plugins.charts.BlocksTrack</a></li><li><a href="epiviz.plugins.charts.BlocksTrackType.html">epiviz.plugins.charts.BlocksTrackType</a></li><li><a href="epiviz.plugins.charts.GenesTrack.html">epiviz.plugins.charts.GenesTrack</a></li><li><a href="epiviz.plugins.charts.GenesTrackType.html">epiviz.plugins.charts.GenesTrackType</a></li><li><a href="epiviz.plugins.charts.HeatmapPlot.html">epiviz.plugins.charts.HeatmapPlot</a></li><li><a href="epiviz.plugins.charts.HeatmapPlotType.html">epiviz.plugins.charts.HeatmapPlotType</a></li><li><a href="epiviz.plugins.charts.LinePlot.html">epiviz.plugins.charts.LinePlot</a></li><li><a href="epiviz.plugins.charts.LinePlotType.html">epiviz.plugins.charts.LinePlotType</a></li><li><a href="epiviz.plugins.charts.LineTrack.html">epiviz.plugins.charts.LineTrack</a></li><li><a href="epiviz.plugins.charts.LineTrackCustom.html">epiviz.plugins.charts.LineTrackCustom</a></li><li><a href="epiviz.plugins.charts.LineTrackType.html">epiviz.plugins.charts.LineTrackType</a></li><li><a href="epiviz.plugins.charts.LineTrackTypeCustom.html">epiviz.plugins.charts.LineTrackTypeCustom</a></li><li><a href="epiviz.plugins.charts.ScatterPlot.html">epiviz.plugins.charts.ScatterPlot</a></li><li><a href="epiviz.plugins.charts.ScatterPlotType.html">epiviz.plugins.charts.ScatterPlotType</a></li><li><a href="epiviz.plugins.charts.StackedLinePlot.html">epiviz.plugins.charts.StackedLinePlot</a></li><li><a href="epiviz.plugins.charts.StackedLinePlotType.html">epiviz.plugins.charts.StackedLinePlotType</a></li><li><a href="epiviz.plugins.charts.StackedLineTrack.html">epiviz.plugins.charts.StackedLineTrack</a></li><li><a href="epiviz.plugins.charts.StackedLineTrackType.html">epiviz.plugins.charts.StackedLineTrackType</a></li><li><a href="epiviz.ui.charts.Chart.html">epiviz.ui.charts.Chart</a></li><li><a href="epiviz.ui.charts.ChartFactory.html">epiviz.ui.charts.ChartFactory</a></li><li><a href="epiviz.ui.charts.ChartManager.html">epiviz.ui.charts.ChartManager</a></li><li><a href="epiviz.ui.charts.ChartObject.html">epiviz.ui.charts.ChartObject</a></li><li><a href="epiviz.ui.charts.ChartType.html">epiviz.ui.charts.ChartType</a></li><li><a href="epiviz.ui.charts.ColorPalette.html">epiviz.ui.charts.ColorPalette</a></li><li><a href="epiviz.ui.charts.CustomSetting.html">epiviz.ui.charts.CustomSetting</a></li><li><a href="epiviz.ui.charts.DataStructureVisualization.html">epiviz.ui.charts.DataStructureVisualization</a></li><li><a href="epiviz.ui.charts.DataStructureVisualizationType.html">epiviz.ui.charts.DataStructureVisualizationType</a></li><li><a href="epiviz.ui.charts.decoration.ChartColorByMeasurementsCodeButton.html">epiviz.ui.charts.decoration.ChartColorByMeasurementsCodeButton</a></li><li><a href="epiviz.ui.charts.decoration.ChartColorByRowCodeButton.html">epiviz.ui.charts.decoration.ChartColorByRowCodeButton</a></li><li><a href="epiviz.ui.charts.decoration.ChartColorsButton.html">epiviz.ui.charts.decoration.ChartColorsButton</a></li><li><a href="epiviz.ui.charts.decoration.ChartFilterCodeButton.html">epiviz.ui.charts.decoration.ChartFilterCodeButton</a></li><li><a href="epiviz.ui.charts.decoration.ChartGroupByMeasurementsCodeButton.html">epiviz.ui.charts.decoration.ChartGroupByMeasurementsCodeButton</a></li><li><a href="epiviz.ui.charts.decoration.ChartLoaderAnimation.html">epiviz.ui.charts.decoration.ChartLoaderAnimation</a></li><li><a href="epiviz.ui.charts.decoration.ChartOptionButton.html">epiviz.ui.charts.decoration.ChartOptionButton</a></li><li><a href="epiviz.ui.charts.decoration.ChartOrderByMeasurementsCodeButton.html">epiviz.ui.charts.decoration.ChartOrderByMeasurementsCodeButton</a></li><li><a href="epiviz.ui.charts.decoration.ChartResize.html">epiviz.ui.charts.decoration.ChartResize</a></li><li><a href="epiviz.ui.charts.decoration.ChartTooltip.html">epiviz.ui.charts.decoration.ChartTooltip</a></li><li><a href="epiviz.ui.charts.decoration.CodeButton.html">epiviz.ui.charts.decoration.CodeButton</a></li><li><a href="epiviz.ui.charts.decoration.CustomSettingsButton.html">epiviz.ui.charts.decoration.CustomSettingsButton</a></li><li><a href="epiviz.ui.charts.decoration.EditCodeButton.html">epiviz.ui.charts.decoration.EditCodeButton</a></li><li><a href="epiviz.ui.charts.decoration.HierarchyFilterCodeButton.html">epiviz.ui.charts.decoration.HierarchyFilterCodeButton</a></li><li><a href="epiviz.ui.charts.decoration.MarkerCodeButton.html">epiviz.ui.charts.decoration.MarkerCodeButton</a></li><li><a href="epiviz.ui.charts.decoration.RemoveChartButton.html">epiviz.ui.charts.decoration.RemoveChartButton</a></li><li><a href="epiviz.ui.charts.decoration.SaveChartButton.html">epiviz.ui.charts.decoration.SaveChartButton</a></li><li><a href="epiviz.ui.charts.decoration.ToggleTooltipButton.html">epiviz.ui.charts.decoration.ToggleTooltipButton</a></li><li><a href="epiviz.ui.charts.decoration.VisualizationDecoration.html">epiviz.ui.charts.decoration.VisualizationDecoration</a></li><li><a href="epiviz.ui.charts.Margins.html">epiviz.ui.charts.Margins</a></li><li><a href="epiviz.ui.charts.markers.MeasurementAggregator.html">epiviz.ui.charts.markers.MeasurementAggregator</a></li><li><a href="epiviz.ui.charts.markers.VisualizationMarker.html">epiviz.ui.charts.markers.VisualizationMarker</a></li><li><a href="epiviz.ui.charts.Plot.html">epiviz.ui.charts.Plot</a></li><li><a href="epiviz.ui.charts.PlotType.html">epiviz.ui.charts.PlotType</a></li><li><a href="epiviz.ui.charts.Track.html">epiviz.ui.charts.Track</a></li><li><a href="epiviz.ui.charts.TrackType.html">epiviz.ui.charts.TrackType</a></li><li><a href="epiviz.ui.charts.transform.clustering.AgglomerativeClustering.html">epiviz.ui.charts.transform.clustering.AgglomerativeClustering</a></li><li><a href="epiviz.ui.charts.transform.clustering.ClusteringAlgorithmFactory.html">epiviz.ui.charts.transform.clustering.ClusteringAlgorithmFactory</a></li><li><a href="epiviz.ui.charts.transform.clustering.ClusterLeaf.html">epiviz.ui.charts.transform.clustering.ClusterLeaf</a></li><li><a href="epiviz.ui.charts.transform.clustering.ClusterSubtree.html">epiviz.ui.charts.transform.clustering.ClusterSubtree</a></li><li><a href="epiviz.ui.charts.transform.clustering.ClusterTree.html">epiviz.ui.charts.transform.clustering.ClusterTree</a></li><li><a href="epiviz.ui.charts.transform.clustering.CompleteLinkage.html">epiviz.ui.charts.transform.clustering.CompleteLinkage</a></li><li><a href="epiviz.ui.charts.transform.clustering.EuclideanMetric.html">epiviz.ui.charts.transform.clustering.EuclideanMetric</a></li><li><a href="epiviz.ui.charts.transform.clustering.NoneClustering.html">epiviz.ui.charts.transform.clustering.NoneClustering</a></li><li><a href="epiviz.ui.charts.tree.decoration.TogglePropagateSelectionButton.html">epiviz.ui.charts.tree.decoration.TogglePropagateSelectionButton</a></li><li><a href="epiviz.ui.charts.tree.HierarchyVisualization.html">epiviz.ui.charts.tree.HierarchyVisualization</a></li><li><a href="epiviz.ui.charts.tree.HierarchyVisualizationType.html">epiviz.ui.charts.tree.HierarchyVisualizationType</a></li><li><a href="epiviz.ui.charts.tree.Icicle.html">epiviz.ui.charts.tree.Icicle</a></li><li><a href="epiviz.ui.charts.tree.IcicleType.html">epiviz.ui.charts.tree.IcicleType</a></li><li><a href="epiviz.ui.charts.tree.Node.html">epiviz.ui.charts.tree.Node</a></li><li><a href="epiviz.ui.charts.tree.Sunburst.html">epiviz.ui.charts.tree.Sunburst</a></li><li><a href="epiviz.ui.charts.tree.UiNode.html">epiviz.ui.charts.tree.UiNode</a></li><li><a href="epiviz.ui.charts.VisEventArgs.html">epiviz.ui.charts.VisEventArgs</a></li><li><a href="epiviz.ui.charts.VisObject.html">epiviz.ui.charts.VisObject</a></li><li><a href="epiviz.ui.charts.Visualization.html">epiviz.ui.charts.Visualization</a></li><li><a href="epiviz.ui.charts.VisualizationProperties.html">epiviz.ui.charts.VisualizationProperties</a></li><li><a href="epiviz.ui.charts.VisualizationType.html">epiviz.ui.charts.VisualizationType</a></li><li><a href="epiviz.ui.ControlManager.html">epiviz.ui.ControlManager</a></li><li><a href="epiviz.ui.controls.CodeControl.html">epiviz.ui.controls.CodeControl</a></li><li><a href="epiviz.ui.controls.CodeDialog.html">epiviz.ui.controls.CodeDialog</a></li><li><a href="epiviz.ui.controls.ColorPickerDialog.html">epiviz.ui.controls.ColorPickerDialog</a></li><li><a href="epiviz.ui.controls.ComputedMeasurementsDialog.html">epiviz.ui.controls.ComputedMeasurementsDialog</a></li><li><a href="epiviz.ui.controls.Control.html">epiviz.ui.controls.Control</a></li><li><a href="epiviz.ui.controls.CustomSettingsDialog.html">epiviz.ui.controls.CustomSettingsDialog</a></li><li><a href="epiviz.ui.controls.DatasourceGroupWizardStep.html">epiviz.ui.controls.DatasourceGroupWizardStep</a></li><li><a href="epiviz.ui.controls.DataTable.html">epiviz.ui.controls.DataTable</a></li><li><a href="epiviz.ui.controls.DataTable.Column.html">epiviz.ui.controls.DataTable.Column</a></li><li><a href="epiviz.ui.controls.Dialog.html">epiviz.ui.controls.Dialog</a></li><li><a href="epiviz.ui.controls.EditCodeControl.html">epiviz.ui.controls.EditCodeControl</a></li><li><a href="epiviz.ui.controls.MarkerCodeControl.html">epiviz.ui.controls.MarkerCodeControl</a></li><li><a href="epiviz.ui.controls.MeaurementsWizardStep.html">epiviz.ui.controls.MeaurementsWizardStep</a></li><li><a href="epiviz.ui.controls.MessageDialog.html">epiviz.ui.controls.MessageDialog</a></li><li><a href="epiviz.ui.controls.SaveSvgAsImageDialog.html">epiviz.ui.controls.SaveSvgAsImageDialog</a></li><li><a href="epiviz.ui.controls.VisConfigSelection.html">epiviz.ui.controls.VisConfigSelection</a></li><li><a href="epiviz.ui.controls.Wizard.html">epiviz.ui.controls.Wizard</a></li><li><a href="epiviz.ui.LocationManager.html">epiviz.ui.LocationManager</a></li><li><a href="epiviz.ui.WebArgsManager.html">epiviz.ui.WebArgsManager</a></li><li><a href="epiviz.utils.IterableArray.html">epiviz.utils.IterableArray</a></li><li><a href="epiviz.workspaces.UserManager.html">epiviz.workspaces.UserManager</a></li><li><a href="epiviz.workspaces.Workspace.html">epiviz.workspaces.Workspace</a></li><li><a href="epiviz.workspaces.WorkspaceManager.html">epiviz.workspaces.WorkspaceManager</a></li></ul><h3>Interfaces</h3><ul><li><a href="epiviz.datatypes.deprecated.GenomicData.html">epiviz.datatypes.deprecated.GenomicData</a></li><li><a href="epiviz.datatypes.GenomicData.html">epiviz.datatypes.GenomicData</a></li><li><a href="epiviz.datatypes.GenomicData.RowItem.html">epiviz.datatypes.GenomicData.RowItem</a></li><li><a href="epiviz.datatypes.MeasurementGenomicData.html">epiviz.datatypes.MeasurementGenomicData</a></li><li><a href="epiviz.datatypes.Range.html">epiviz.datatypes.Range</a></li><li><a href="epiviz.ui.charts.transform.clustering.ClusteringLinkage.html">epiviz.ui.charts.transform.clustering.ClusteringLinkage</a></li><li><a href="epiviz.ui.charts.transform.clustering.ClusteringMetric.html">epiviz.ui.charts.transform.clustering.ClusteringMetric</a></li><li><a href="epiviz.ui.charts.transform.clustering.ClusterNode.html">epiviz.ui.charts.transform.clustering.ClusterNode</a></li><li><a href="epiviz.ui.charts.transform.clustering.HierarchicalClusteringAlgorithm.html">epiviz.ui.charts.transform.clustering.HierarchicalClusteringAlgorithm</a></li><li><a href="epiviz.ui.controls.Wizard.Step.html">epiviz.ui.controls.Wizard.Step</a></li><li><a href="epiviz.utils.Iterable.html">epiviz.utils.Iterable</a></li><li><a href="epiviz.utils.Iterator.html">epiviz.utils.Iterator</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Wed May 11 2016 13:52:40 GMT-0400 (EDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
