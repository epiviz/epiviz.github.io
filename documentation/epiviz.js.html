<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: epiviz.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: epiviz.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Created by: Florin Chelaru
 * Date: 10/2/13
 * Time: 12:46 PM
 */

goog.provide('epiviz.EpiViz');

goog.require('epiviz.Config');
goog.require('epiviz.data.DataProviderFactory');
goog.require('epiviz.data.DataManager');
goog.require('epiviz.data.DataProvider');
goog.require('epiviz.ui.PrintManager');


/**
 * @param {epiviz.Config} config
 * @param {epiviz.ui.LocationManager} locationManager
 * @param {epiviz.measurements.MeasurementsManager} measurementsManager
 * @param {epiviz.ui.ControlManager} controlManager
 * @param {epiviz.data.DataManager} dataManager
 * @param {epiviz.ui.charts.ChartFactory} chartFactory
 * @param {epiviz.ui.charts.ChartManager} chartManager
 * @param {epiviz.workspaces.WorkspaceManager} workspaceManager
 * @param {epiviz.workspaces.UserManager} userManager
 * @param {epiviz.ui.WebArgsManager} webArgsManager
 * @param {epiviz.localstorage.LocalStorageManager} [cookieManager]
 * @constructor
 */
epiviz.EpiViz = function(config, locationManager, measurementsManager, controlManager, dataManager, chartFactory, chartManager, workspaceManager, userManager, webArgsManager, cookieManager) {
  /**
   * @type {epiviz.Config}
   * @private
   */
  this._config = config;

  /**
   * @type {epiviz.ui.LocationManager}
   * @private
   */
  this._locationManager = locationManager;

  /**
   * @type {epiviz.measurements.MeasurementsManager}
   * @private
   */
  this._measurementsManager = measurementsManager;

  /**
   * @type {epiviz.ui.ControlManager}
   * @private
   */
  this._controlManager = controlManager;

  /**
   * @type {epiviz.data.DataManager}
   * @private
   */
  this._dataManager = dataManager;

  /**
   * @type {epiviz.ui.charts.ChartFactory}
   * @private
   */
  this._chartFactory = chartFactory;

  /**
   * @type {epiviz.ui.charts.ChartManager}
   * @private
   */
  this._chartManager = chartManager;

  /**
   * @type {epiviz.workspaces.WorkspaceManager}
   * @private
   */
  this._workspaceManager = workspaceManager;

  /**
   * @type {epiviz.workspaces.UserManager}
   * @private
   */
  this._userManager = userManager;

  /**
   * @type {epiviz.ui.WebArgsManager}
   * @private
   */
  this._webArgsManager = webArgsManager;

  /**
   * @type {epiviz.localstorage.LocalStorageManager}
   * @private
   */
  this._cookieManager = cookieManager;

  // Register for UI events

  this._registerRequestSeqInfos();
  this._registerRequestMeasurements();

  this._registerUiAddChart();
  this._registerUiSaveWorkspace();
  this._registerUiDeleteActiveWorkspace();
  this._registerUiRevertActiveWorkspace();
  this._registerUiLoginLinkClicked();
  this._registerUiSearchWorkspaces();
  this._registerUiActiveWorkspaceChanged();
  this._registerUiSearch();

  this._registerChartRequestHierarchy();
  this._registerChartPropagateHierarchySelection();

  this._registerUiSettingsChanged();

  // Register for Data events

  this._registerDataAddMeasurements();
  this._registerDataRemoveMeasurements();
  this._registerDataAddChart();
  this._registerDataRemoveChart();
  this._registerDataAddSeqInfos();
  this._registerDataRemoveSeqNames();
  this._registerDataNavigate();
  this._registerDataRedraw();
  this._registerDataGetCurrentLocation();
  this._registerPrintWorkspace();
  this._registerDataSetChartSettings();
  this._registerDataGetChartSettings();
  this._registerDataGetAvailableCharts();

  // Register for Workspace events

  this._registerRequestWorkspaces();
  this._registerWorkspacesLoaded();
  this._registerActiveWorkspaceChanged();
  this._registerActiveWorkspaceContentChanged();
  this._registerLocationChanged();

  /*
   * Prevent closing if workspace has changed
   */
  var self = this;
  // TODO: Cleanup
  /*window.onbeforeunload = function() {
    if (epiviz.workspaces.UserManager.USER_STATUS.loggedIn &amp;&amp; self._workspaceManager.activeWorkspace().changed()) {
      return 'There are unsaved changes in the current workspace.';
    }
    return undefined;
   };*/
};

/**
 * @type {string}
 * @const
 */
epiviz.EpiViz.VERSION = '4';

epiviz.EpiViz.prototype.start = function() {
  this._cookieManager.initialize();

  this._controlManager.initialize();
  
  this._workspaceManager.initialize();

  this._measurementsManager.initialize();

  this._locationManager.initialize();
};

/**
 * @returns {epiviz.Config}
 */
epiviz.EpiViz.prototype.config = function() {
  return this._config;
};

/**
 * @param {epiviz.ui.charts.ChartType} type
 * @param {epiviz.ui.controls.VisConfigSelection} visConfigSelection
 * @param {string} [chartId] If specified, then this will be
 *   the id of the newly created chart. Otherwise, a new one
 *   will be generated.
 * @param {epiviz.ui.charts.VisualizationProperties} [chartProperties]
 * @returns {string} the id of the chart just created
 * @private
 */
epiviz.EpiViz.prototype._addChart = function(type, visConfigSelection, chartId, chartProperties) {
  chartId = this._chartManager.addChart(type, visConfigSelection, chartId, chartProperties);
  var self = this;
  // TODO: Maybe later implement hierarchical display type (see display-type.js for the start of the idea)
  if (type.chartDisplayType() == epiviz.ui.charts.VisualizationType.DisplayType.DATA_STRUCTURE) {
    var chartVisConfigSelectionMap = {};
    chartVisConfigSelectionMap[chartId] = visConfigSelection;
    this._dataManager.getHierarchy(chartVisConfigSelectionMap,
      function(chartId, hierarchy) {
        self._chartManager.updateCharts(undefined, hierarchy, [chartId]);
      });
  } else {
    var range = this._workspaceManager.activeWorkspace().range();
    this._chartManager.dataWaitStart(chartId);
    var chartMeasurementsMap = {};
    chartMeasurementsMap[chartId] = visConfigSelection.measurements;
    this._dataManager.getData(range, chartMeasurementsMap,
      function(chartId, data) {
        self._chartManager.updateCharts(range, data, [chartId]);
      });
  }

  return chartId;
};

/*****************************************************************************
 * UI Events                                                                 *
 *****************************************************************************/

/**
 * @private
 */
epiviz.EpiViz.prototype._registerRequestSeqInfos = function() {
  var self = this;
  this._locationManager.onRequestSeqInfos().addListener(new epiviz.events.EventListener(
    function() {
      self._dataManager.getSeqInfos(function(seqInfos) {
        self._locationManager.updateSeqInfos(seqInfos);
      });
    }));
};

/**
 * @private
 */
epiviz.EpiViz.prototype._registerRequestMeasurements = function() {
  var self = this;
  this._measurementsManager.onRequestMeasurements().addListener(new epiviz.events.EventListener(
    function() {
      self._dataManager.getMeasurements(function(measurements) {
        self._measurementsManager.addMeasurements(measurements);

        //self._workspaceManager.initialize();
      });
    }));
};

/**
 * @private
 */
epiviz.EpiViz.prototype._registerRequestWorkspaces = function() {
  var self = this;
  this._workspaceManager.onRequestWorkspaces().addListener(new epiviz.events.EventListener(
    /**
     * @param {{activeWorkspaceId: string}} e
     */
    function(e) {
      var cookieWorkspace = self._cookieManager.getWorkspace(self._chartFactory, self._config);
      self._dataManager.getWorkspaces(function(rawWorkspaces) {
        var ws = [];
        var activeWorkspace = null;
        var unchangedActiveWorkspace = null;
        for (var i = 0; i &lt; rawWorkspaces.length; ++i) {
           var w = epiviz.workspaces.Workspace.fromRawObject(rawWorkspaces[i], self._chartFactory, self._config);

          if (w.id() === null) {
            // This is a workspace retrieved using e.activeWorkspaceId
            // and belonging to another user
            activeWorkspace = w;
            continue;
          }

          if (w.id() == e.activeWorkspaceId) {
            if (cookieWorkspace &amp;&amp; cookieWorkspace.id() == e.activeWorkspaceId) {
              unchangedActiveWorkspace = w;
              w = cookieWorkspace;
            }
            activeWorkspace = w;
          }

          ws.push(w);
        }

        if (!activeWorkspace &amp;&amp; cookieWorkspace) {
          unchangedActiveWorkspace = self._workspaceManager.get(cookieWorkspace.id());
          if (!unchangedActiveWorkspace) {
            cookieWorkspace = cookieWorkspace.copy(cookieWorkspace.name());
            unchangedActiveWorkspace = epiviz.workspaces.Workspace.fromRawObject(self._config.defaultWorkspaceSettings, self._chartFactory, self._config);
          }
          activeWorkspace = cookieWorkspace;
        }

        self._workspaceManager.updateWorkspaces(ws, activeWorkspace, e.activeWorkspaceId, unchangedActiveWorkspace);
        if (!cookieWorkspace) { self._workspaceManager.activeWorkspace().resetChanged(); }
       }, '', e.activeWorkspaceId);
    }));
};

/**
 * @private
 */
epiviz.EpiViz.prototype._registerUiAddChart = function() {
  var self = this;
  this._controlManager.onAddChart().addListener(new epiviz.events.EventListener(
    /** @param {{type: epiviz.ui.charts.ChartType, visConfigSelection: epiviz.ui.controls.VisConfigSelection}} e */
    function(e) {
      self._addChart(e.type, e.visConfigSelection);
    }));
};

/**
 * @private
 */
epiviz.EpiViz.prototype._registerUiSaveWorkspace = function() {
  var self = this;
  this._controlManager.onSaveWorkspace().addListener(new epiviz.events.EventListener(
    /**
     * @param {{name: string, id: ?string}} e
     */
    function(e) {
      // If there is a workspace with this name in the set of workspaces, overwrite it
      // Otherwise, create a copy of the active workspace with the new name, and save that.
      var workspace = self._workspaceManager.getByName(e.name);
      if (workspace) {
        workspace = self._workspaceManager.activeWorkspace().copy(e.name, workspace.id());
      } else {
        workspace = self._workspaceManager.activeWorkspace().copy(e.name);
      }

      self._dataManager.saveWorkspace(workspace, self._config, function(id) {
        workspace = workspace.copy(workspace.name(), id);
        workspace.resetChanged();

        self._workspaceManager.updateWorkspace(workspace);
        self._workspaceManager.changeActiveWorkspace(id);
      });
    }
  ));
};

/**
 * @private
 */
epiviz.EpiViz.prototype._registerUiDeleteActiveWorkspace = function() {
  var self = this;
  this._controlManager.onDeleteActiveWorkspace().addListener(new epiviz.events.EventListener(
    function() {
      self._dataManager.deleteWorkspace(self._workspaceManager.activeWorkspace());
      self._workspaceManager.deleteActiveWorkspace();
    }
  ));
};

/**
 * @private
 */
epiviz.EpiViz.prototype._registerUiRevertActiveWorkspace = function() {
  var self = this;
  this._controlManager.onRevertActiveWorkspace().addListener(new epiviz.events.EventListener(
    function() {
      self._workspaceManager.revertActiveWorkspace();
    }
  ));
};

/**
 * @private
 */
epiviz.EpiViz.prototype._registerUiLoginLinkClicked = function() {
  var self = this;
  this._controlManager.onLoginLinkClicked().addListener(new epiviz.events.EventListener(function() {
    self._userManager.toggleLogin();
  }));
};

/**
 * @private
 */
epiviz.EpiViz.prototype._registerUiSearchWorkspaces = function() {
  var self = this;
  this._controlManager.onSearchWorkspaces().addListener(new epiviz.events.EventListener(
    /**
     * @param {{searchTerm: string, callback: function(Array.&lt;epiviz.workspaces.Workspace>)}} e
     */
    function(e) {
      self._dataManager.getWorkspaces(function(workspaces) {
        e.callback(workspaces);
      }, e.searchTerm, e.searchTerm);
    }
  ))
};

/**
 * @private
 */
epiviz.EpiViz.prototype._registerUiActiveWorkspaceChanged = function() {
  var self = this;
  this._controlManager.onActiveWorkspaceChanged().addListener(new epiviz.events.EventListener(
    /**
     * @param {{oldValue: {id: string, name: string}, newValue: {id: string, name: string}, cancel: function}} e
     */
    function(e) {

      var doChangeActiveWorkspace = function() {
        if (e.newValue.id &amp;&amp; !self._workspaceManager.get(e.newValue.id)) {
          // The requested workspace id belongs to another user, so it has to be retrieved
          self._dataManager.getWorkspaces(function(rawWorkspaces) {
            var result = null;
            for (var i = 0; i &lt; rawWorkspaces.length; ++i) {
              var w = epiviz.workspaces.Workspace.fromRawObject(rawWorkspaces[i], self._chartFactory, self._config);

              if (w.id() === null) {
                // This is a workspace retrieved using e.activeWorkspaceId
                // and belonging to another user
                result = w;
                break;
              }
            }

            if (result) {
              self._workspaceManager.changeActiveWorkspace(e.newValue.id, result);
            }
          }, e.newValue.name, e.newValue.id);
        } else { self._workspaceManager.changeActiveWorkspace(e.newValue.id); }
      };

      if (epiviz.workspaces.UserManager.USER_STATUS.loggedIn &amp;&amp; !self._workspaceManager.activeWorkspaceChanging() &amp;&amp; self._workspaceManager.activeWorkspace().changed()) {
        var dialog = new epiviz.ui.controls.MessageDialog(
          'Discard workspace changes',
          {
            Yes: function() {
              doChangeActiveWorkspace();
            },
            No: function() {
              e.cancel();
            }
          },
          'There are unsaved changes in the current workspace. Do you wish to discard them?',
          epiviz.ui.controls.MessageDialog.Icon.QUESTION);
        dialog.show();
      } else {
        doChangeActiveWorkspace();
      }
    }
  ));
};

/**
 * @private
 */
epiviz.EpiViz.prototype._registerUiSearch = function() {
  var self = this;
  this._controlManager.onSearch().addListener(new epiviz.events.EventListener(
    /**
     * @param {{searchTerm: string, callback: (function(Array.&lt;{probe: string, gene: string, seqName: string, start: number, end: number}>))}} e
     */
    function(e) {
      self._dataManager.search(function(results) {
        e.callback(results);
      }, e.searchTerm);
    }));
};

/**
 * @private
 */
epiviz.EpiViz.prototype._registerChartRequestHierarchy = function() {
  var self = this;
  this._chartManager.onChartRequestHierarchy().addListener(new epiviz.events.EventListener(function(e) {
    var map = {};
    map[e.id] = e.args;
    self._dataManager.getHierarchy(map, function(chartId, data) {
      self._chartManager.updateCharts(undefined, data, [chartId]);
    })
  }));
};

/**
 * @private
 */
epiviz.EpiViz.prototype._registerChartPropagateHierarchySelection = function() {
  var self = this;
  this._chartManager.onChartPropagateHierarchyChanges().addListener(new epiviz.events.EventListener(function(e) {
    var map = {};
    map[e.id] = e.args;
    self._dataManager.propagateHierarchyChanges(map, function(chartId, data) {
      self._chartManager.updateCharts(undefined, data, [chartId]);
    })
  }));
};


/**
 * @private
 */
epiviz.EpiViz.prototype._registerUiSettingsChanged = function() {
  var self = this;
  this._workspaceManager.onUiChartSettingsChanged().addListener(new epiviz.events.EventListener(
      function(e) {
        //do nothing!
        self._dataManager.updateChartSettings(e);
      }));
};

/*****************************************************************************
 * Data                                                                      *
 *****************************************************************************/

/**
 * @private
 */
epiviz.EpiViz.prototype._registerDataAddMeasurements = function() {
  var self = this;
  this._dataManager.onRequestAddMeasurements().addListener(new epiviz.events.EventListener(
    /** @param {{measurements: epiviz.measurements.MeasurementSet, result: epiviz.events.EventResult}} e */
    function(e) {
      try {
        self._measurementsManager.addMeasurements(e.measurements);
        e.result.success = true;
      } catch (error) {
        e.result.success = false;
        e.result.errorMessage = error.toString();
      }
    }));
};

/**
 * @private
 */
epiviz.EpiViz.prototype._registerDataRemoveMeasurements = function() {
  var self = this;
  this._dataManager.onRequestRemoveMeasurements().addListener(new epiviz.events.EventListener(
    /** @param {{measurements: epiviz.measurements.MeasurementSet, result: epiviz.events.EventResult}} e */
      function(e) {
      try {
        self._measurementsManager.removeMeasurements(e.measurements);
        e.result.success = true;
      } catch (error) {
        e.result.success = false;
        e.result.errorMessage = error.toString();
      }
    }));
};

/**
 * @private
 */
epiviz.EpiViz.prototype._registerDataAddChart = function() {
  var self = this;
  this._dataManager.onRequestAddChart().addListener(new epiviz.events.EventListener(
    /** @param {{type: string, visConfigSelection: epiviz.ui.controls.VisConfigSelection, result: epiviz.events.EventResult}} e */
    function(e) {
      try {
        var chartType = self._chartFactory.get(e.type);
        var chartId = self._addChart(chartType, e.visConfigSelection);
        e.result.success = true;
        e.result.value = { id: chartId };
      } catch (error) {
        e.result.success = false;
        e.result.errorMessage = error.toString();
      }
    }));
};

/**
 * @private
 */
epiviz.EpiViz.prototype._registerDataRemoveChart = function() {
  var self = this;
  this._dataManager.onRequestRemoveChart().addListener(new epiviz.events.EventListener(
    /**
     * @param {{id: string, result: epiviz.events.EventResult}} e
     */
    function(e) {
      try {
        self._chartManager.removeChart(e.id);
        e.result.success = true;
      } catch (error) {
        e.result.success = false;
        e.errorMessage = error.toString();
      }
    }));
};

/**
 * @private
 */
epiviz.EpiViz.prototype._registerPrintWorkspace = function() {
  var self = this;
  this._dataManager.onRequestPrintWorkspace().addListener(new epiviz.events.EventListener(
      /**
       * @param {{id: string, result: epiviz.events.EventResult}} e
       */
      function(e) {
        try {
          var pm = new epiviz.ui.PrintManager(e.chartId, e.fileName, e.fileType);
          pm.print();
          //self._controlManager.printWorkspace(e.chartId, e.fileName, e.fileType);
          e.result.success = true;
        } catch (error) {
          e.result.success = false;
          e.errorMessage = error.toString();
        }
      }));
};


/**
 * @private
 */
epiviz.EpiViz.prototype._registerDataSetChartSettings = function() {
  var self = this;
  this._dataManager.onRequestSetChartSettings().addListener(new epiviz.events.EventListener(
      /**
       * @param {{id: string, settings: Array, result: epiviz.events.EventResult}} e
       */
      function(e) {
        try {
            self._chartManager.setChartSettings(e.chartId, e.settings, e.colorMap);
            e.result.success = true;
          } catch(error) {
            e.result.success = false;
            e.result.errorMessage = error.toString();
          }
        })
  );
};

/**
 * @private
 */
epiviz.EpiViz.prototype._registerDataGetChartSettings = function() {
  var self = this;
  this._dataManager.onRequestGetChartSettings().addListener(new epiviz.events.EventListener(
      /**
       * @param {{id: string, settings: Array, result: epiviz.events.EventResult}} e
       */
      function(e) {
        try {
          self._chartManager.getChartSettings(e.chartId);
          e.result.success = true;
        } catch(error) {
          e.result.success = false;
          e.result.errorMessage = error.toString();
        }
      })
  );
};


/**
 * @private
 */
epiviz.EpiViz.prototype._registerDataGetAvailableCharts = function() {
  var self = this;
  this._dataManager.onRequestGetChartSettings().addListener(new epiviz.events.EventListener(
      /**
       * @param {{id: string, settings: Array, result: epiviz.events.EventResult}} e
       */
      function(e) {
        try {
          e.result.value = [];
          self._chartFactory.foreach(function(chartName, chartType) {

            e.result.value.push({
              'chartName': chartName,
              'customSettings': chartType.customSettingsDefs(),
              'colorMap':chartType.defaultColors()._colors});
          });
          e.result.success = true;
        } catch(error) {
          e.result.success = false;
          e.result.errorMessage = error.toString();
        }
      })
  );
};



/**
 * @private
 */
epiviz.EpiViz.prototype._registerDataAddSeqInfos = function() {
  var self = this;
  this._dataManager.onRequestAddSeqInfos().addListener(new epiviz.events.EventListener(
    /**
     * @param {{seqInfos: Array.&lt;epiviz.datatypes.SeqInfo>, result: epiviz.events.EventResult}} e
     */
    function(e) {
      try {
        self._locationManager.addSeqInfos(e.seqInfos);
        e.result.success = true;
      } catch (error) {
        e.result.success = false;
        e.errorMessage = error.toString();
      }
    }));
};

/**
 * @private
 */
epiviz.EpiViz.prototype._registerDataRemoveSeqNames = function() {
  var self = this;
  this._dataManager.onRequestRemoveSeqNames().addListener(new epiviz.events.EventListener(
    /**
     * @param {{seqNames: Array.&lt;string>, result: epiviz.events.EventResult}} e
     */
    function(e) {
      try {
        self._locationManager.removeSeqNames(e.seqNames);
        e.result.success = true;
      } catch (error) {
        e.result.success = false;
        e.errorMessage = error.toString();
      }
    }));
};

/**
 * @private
 */
epiviz.EpiViz.prototype._registerDataNavigate = function() {
  var self = this;
  this._dataManager.onRequestNavigate().addListener(new epiviz.events.EventListener(
    /**
     * @param {{range: epiviz.datatypes.GenomicRange, result: epiviz.events.EventResult}} e
     */
    function(e) {
      try {
        self._locationManager.changeCurrentLocation(e.range);
        e.result.success = true;
      } catch (error) {
        e.result.success = false;
        e.errorMessage = error.toString();
      }
    }));
};

/**
 * @private
 */
epiviz.EpiViz.prototype._registerDataRedraw = function() {
  var self = this;
  this._dataManager.onRequestRedraw().addListener(new epiviz.events.EventListener(
    /**
     * @param {{result: epiviz.events.EventResult}} e
     */
    function(e) {
      try {
        var currentLocation = self._locationManager.currentLocation();
        self._locationManager.changeCurrentLocation(currentLocation);
        e.result.success = true;

        self._chartManager.updateDataStructureCharts();
      } catch (error) {
        e.result.success = false;
        e.errorMessage = error.toString();
      }
    }));
};

/**
 * @private
 */
epiviz.EpiViz.prototype._registerDataGetCurrentLocation = function() {
  var self = this;
  this._dataManager.onRequestCurrentLocation().addListener(new epiviz.events.EventListener(
    /**
     * @param {{result: epiviz.events.EventResult}} e
     */
      function(e) {
      try {
        var currentLocation = self._locationManager.currentLocation();
        e.result.value = { seqName: currentLocation.seqName(), start: currentLocation.start(), end: currentLocation.end() };
        e.result.success = true;
      } catch (error) {
        e.result.success = false;
        e.errorMessage = error.toString();
      }
    }));
};

/*****************************************************************************
 * Workspaces                                                                *
 *****************************************************************************/

/**
 * @private
 */
epiviz.EpiViz.prototype._registerWorkspacesLoaded = function() {
  var self = this;
  this._workspaceManager.onWorkspacesLoaded().addListener(new epiviz.events.EventListener(
    /**
     * @param {{
     *   activeWorkspace: epiviz.workspaces.Workspace,
     *   workspaces: Array.&lt;epiviz.workspaces.Workspace>
     * }} e
     */
    function(e) {
    }));
};

/**
 * @private
 */
epiviz.EpiViz.prototype._registerActiveWorkspaceChanged = function() {
  var self = this;
  this._workspaceManager.onActiveWorkspaceChanged().addListener(new epiviz.events.EventListener(
    /**
     * @param {{oldValue: epiviz.workspaces.Workspace, newValue: epiviz.workspaces.Workspace, workspaceId: string}} e
     */
    function(e) {
      self._workspaceManager.startChangingActiveWorkspace();

      self._controlManager.updateSelectedWorkspace({id: e.newValue.id(), name: e.newValue.name()});
      self._locationManager.changeCurrentLocation(e.newValue.range());

      self._measurementsManager.removeMeasurements(self._measurementsManager.computedMeasurements());
      self._measurementsManager.addMeasurements(e.newValue.computedMeasurements());

      self._chartManager.clear();

      /**
       * @type {Object.&lt;epiviz.ui.charts.VisualizationType.DisplayType, Array.&lt;{id: string, type: epiviz.ui.charts.ChartType, properties: epiviz.ui.charts.VisualizationProperties}>>}
       */
      var charts = e.newValue.charts();

      for (var displayType in charts) {
        if (!charts.hasOwnProperty(displayType)) { continue; }

        for (var i = 0; i &lt; charts[displayType].length; ++i) {
          self._addChart(charts[displayType][i].type, charts[displayType][i].properties.visConfigSelection, charts[displayType][i].id, charts[displayType][i].properties.copy());
        }
      }

      self._workspaceManager.endChangingActiveWorkspace();
    }
  ));
};

/**
 * @private
 */
epiviz.EpiViz.prototype._registerActiveWorkspaceContentChanged = function() {
  var self = this;
  this._workspaceManager.onActiveWorkspaceContentChanged().addListener(new epiviz.events.EventListener(
    /**
     * @param {epiviz.workspaces.Workspace} w
     */
    function(w) {
      self._cookieManager.saveWorkspace(w, self._config);
    }
  ));
};

/**
 * @private
 */
epiviz.EpiViz.prototype._registerLocationChanged = function() {
  var self = this;
  this._locationManager.onCurrentLocationChanged().addListener(new epiviz.events.EventListener(
    /**
     * @param {{oldValue: epiviz.datatypes.GenomicRange, newValue: epiviz.datatypes.GenomicRange}} e
     */
    function(e) {
      self._chartManager.dataWaitStart(undefined,
        /**
         * @param {epiviz.ui.charts.Visualization} chart
         * @returns {boolean}
         */
        function(chart) {
          return chart.displayType() != epiviz.ui.charts.VisualizationType.DisplayType.DATA_STRUCTURE;
        });

      /** @type {Object.&lt;string, epiviz.measurements.MeasurementSet>} */
      var chartMeasurementsMap = self._chartManager.chartsMeasurements();

      self._dataManager.getData(e.newValue, chartMeasurementsMap,
        function(chartId, data) {
          self._chartManager.updateCharts(e.newValue, data, [chartId]);
        });
    }));
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="epiviz.Config.html">epiviz.Config</a></li><li><a href="epiviz.data.Cache.html">epiviz.data.Cache</a></li><li><a href="epiviz.data.DataManager.html">epiviz.data.DataManager</a></li><li><a href="epiviz.data.DataProvider.html">epiviz.data.DataProvider</a></li><li><a href="epiviz.data.DataProviderFactory.html">epiviz.data.DataProviderFactory</a></li><li><a href="epiviz.data.EmptyResponseDataProvider.html">epiviz.data.EmptyResponseDataProvider</a></li><li><a href="epiviz.data.EpivizApiDataProvider.html">epiviz.data.EpivizApiDataProvider</a></li><li><a href="epiviz.data.EpivizApiDataProvider.Request.html">epiviz.data.EpivizApiDataProvider.Request</a></li><li><a href="epiviz.data.EpivizApiDataProvider.Response.html">epiviz.data.EpivizApiDataProvider.Response</a></li><li><a href="epiviz.data.MetagenomicsDataProvider.html">epiviz.data.MetagenomicsDataProvider</a></li><li><a href="epiviz.data.MockDataProvider.html">epiviz.data.MockDataProvider</a></li><li><a href="epiviz.data.Request.html">epiviz.data.Request</a></li><li><a href="epiviz.data.RequestStack.html">epiviz.data.RequestStack</a></li><li><a href="epiviz.data.Response.html">epiviz.data.Response</a></li><li><a href="epiviz.data.Response.fromRawObject.html">epiviz.data.Response.fromRawObject</a></li><li><a href="epiviz.data.WebServerDataProvider.html">epiviz.data.WebServerDataProvider</a></li><li><a href="epiviz.data.WebsocketDataProvider.html">epiviz.data.WebsocketDataProvider</a></li><li><a href="epiviz.datatypes.deprecated.GenomicRanges.html">epiviz.datatypes.deprecated.GenomicRanges</a></li><li><a href="epiviz.datatypes.deprecated.GenomicRanges.Hits.html">epiviz.datatypes.deprecated.GenomicRanges.Hits</a></li><li><a href="epiviz.datatypes.deprecated.GenomicRanges.Row.html">epiviz.datatypes.deprecated.GenomicRanges.Row</a></li><li><a href="epiviz.datatypes.deprecated.GenomicRanges.Subset.html">epiviz.datatypes.deprecated.GenomicRanges.Subset</a></li><li><a href="epiviz.datatypes.deprecated.SeqInfo.html">epiviz.datatypes.deprecated.SeqInfo</a></li><li><a href="epiviz.datatypes.FeatureValueArray.html">epiviz.datatypes.FeatureValueArray</a></li><li><a href="epiviz.datatypes.GenomicArray.html">epiviz.datatypes.GenomicArray</a></li><li><a href="epiviz.datatypes.GenomicData.ValueItem.html">epiviz.datatypes.GenomicData.ValueItem</a></li><li><a href="epiviz.datatypes.GenomicRange.html">epiviz.datatypes.GenomicRange</a></li><li><a href="epiviz.datatypes.GenomicRangeArray.html">epiviz.datatypes.GenomicRangeArray</a></li><li><a href="epiviz.datatypes.GenomicRangeArray.RowItemWrapper.html">epiviz.datatypes.GenomicRangeArray.RowItemWrapper</a></li><li><a href="epiviz.datatypes.ItemFilteredGenomicData.html">epiviz.datatypes.ItemFilteredGenomicData</a></li><li><a href="epiviz.datatypes.MapGenomicData.html">epiviz.datatypes.MapGenomicData</a></li><li><a href="epiviz.datatypes.MeasurementAggregatedGenomicData.html">epiviz.datatypes.MeasurementAggregatedGenomicData</a></li><li><a href="epiviz.datatypes.MeasurementGenomicDataArrayWrapper.html">epiviz.datatypes.MeasurementGenomicDataArrayWrapper</a></li><li><a href="epiviz.datatypes.MeasurementGenomicDataWrapper.html">epiviz.datatypes.MeasurementGenomicDataWrapper</a></li><li><a href="epiviz.datatypes.MeasurementOrderedGenomicData.html">epiviz.datatypes.MeasurementOrderedGenomicData</a></li><li><a href="epiviz.datatypes.PartialSummarizedExperiment.html">epiviz.datatypes.PartialSummarizedExperiment</a></li><li><a href="epiviz.datatypes.RowItemImpl.html">epiviz.datatypes.RowItemImpl</a></li><li><a href="epiviz.datatypes.SeqInfo.html">epiviz.datatypes.SeqInfo</a></li><li><a href="epiviz.deferred.Deferred.html">epiviz.deferred.Deferred</a></li><li><a href="epiviz.deferred.Promise.html">epiviz.deferred.Promise</a></li><li><a href="epiviz.EpiViz.html">epiviz.EpiViz</a></li><li><a href="epiviz.events.Event.html">epiviz.events.Event</a></li><li><a href="epiviz.events.EventListener.html">epiviz.events.EventListener</a></li><li><a href="epiviz.events.EventResult.html">epiviz.events.EventResult</a></li><li><a href="epiviz.localstorage.LocalStorageManager.html">epiviz.localstorage.LocalStorageManager</a></li><li><a href="epiviz.measurements.Measurement.html">epiviz.measurements.Measurement</a></li><li><a href="epiviz.measurements.MeasurementHashtable.html">epiviz.measurements.MeasurementHashtable</a></li><li><a href="epiviz.measurements.MeasurementHashtable.Iterator.html">epiviz.measurements.MeasurementHashtable.Iterator</a></li><li><a href="epiviz.measurements.MeasurementSet.html">epiviz.measurements.MeasurementSet</a></li><li><a href="epiviz.measurements.MeasurementSet.Iterator.html">epiviz.measurements.MeasurementSet.Iterator</a></li><li><a href="epiviz.measurements.MeasurementsManager.html">epiviz.measurements.MeasurementsManager</a></li><li><a href="epiviz.plugins.charts.BlocksTrack.html">epiviz.plugins.charts.BlocksTrack</a></li><li><a href="epiviz.plugins.charts.BlocksTrackType.html">epiviz.plugins.charts.BlocksTrackType</a></li><li><a href="epiviz.plugins.charts.GenesTrack.html">epiviz.plugins.charts.GenesTrack</a></li><li><a href="epiviz.plugins.charts.GenesTrackType.html">epiviz.plugins.charts.GenesTrackType</a></li><li><a href="epiviz.plugins.charts.HeatmapPlot.html">epiviz.plugins.charts.HeatmapPlot</a></li><li><a href="epiviz.plugins.charts.HeatmapPlotType.html">epiviz.plugins.charts.HeatmapPlotType</a></li><li><a href="epiviz.plugins.charts.LinePlot.html">epiviz.plugins.charts.LinePlot</a></li><li><a href="epiviz.plugins.charts.LinePlotType.html">epiviz.plugins.charts.LinePlotType</a></li><li><a href="epiviz.plugins.charts.LineTrack.html">epiviz.plugins.charts.LineTrack</a></li><li><a href="epiviz.plugins.charts.LineTrackCustom.html">epiviz.plugins.charts.LineTrackCustom</a></li><li><a href="epiviz.plugins.charts.LineTrackType.html">epiviz.plugins.charts.LineTrackType</a></li><li><a href="epiviz.plugins.charts.LineTrackTypeCustom.html">epiviz.plugins.charts.LineTrackTypeCustom</a></li><li><a href="epiviz.plugins.charts.ScatterPlot.html">epiviz.plugins.charts.ScatterPlot</a></li><li><a href="epiviz.plugins.charts.ScatterPlotType.html">epiviz.plugins.charts.ScatterPlotType</a></li><li><a href="epiviz.plugins.charts.StackedLinePlot.html">epiviz.plugins.charts.StackedLinePlot</a></li><li><a href="epiviz.plugins.charts.StackedLinePlotType.html">epiviz.plugins.charts.StackedLinePlotType</a></li><li><a href="epiviz.plugins.charts.StackedLineTrack.html">epiviz.plugins.charts.StackedLineTrack</a></li><li><a href="epiviz.plugins.charts.StackedLineTrackType.html">epiviz.plugins.charts.StackedLineTrackType</a></li><li><a href="epiviz.ui.charts.Chart.html">epiviz.ui.charts.Chart</a></li><li><a href="epiviz.ui.charts.ChartFactory.html">epiviz.ui.charts.ChartFactory</a></li><li><a href="epiviz.ui.charts.ChartManager.html">epiviz.ui.charts.ChartManager</a></li><li><a href="epiviz.ui.charts.ChartObject.html">epiviz.ui.charts.ChartObject</a></li><li><a href="epiviz.ui.charts.ChartType.html">epiviz.ui.charts.ChartType</a></li><li><a href="epiviz.ui.charts.ColorPalette.html">epiviz.ui.charts.ColorPalette</a></li><li><a href="epiviz.ui.charts.CustomSetting.html">epiviz.ui.charts.CustomSetting</a></li><li><a href="epiviz.ui.charts.DataStructureVisualization.html">epiviz.ui.charts.DataStructureVisualization</a></li><li><a href="epiviz.ui.charts.DataStructureVisualizationType.html">epiviz.ui.charts.DataStructureVisualizationType</a></li><li><a href="epiviz.ui.charts.decoration.ChartColorByMeasurementsCodeButton.html">epiviz.ui.charts.decoration.ChartColorByMeasurementsCodeButton</a></li><li><a href="epiviz.ui.charts.decoration.ChartColorByRowCodeButton.html">epiviz.ui.charts.decoration.ChartColorByRowCodeButton</a></li><li><a href="epiviz.ui.charts.decoration.ChartColorsButton.html">epiviz.ui.charts.decoration.ChartColorsButton</a></li><li><a href="epiviz.ui.charts.decoration.ChartFilterCodeButton.html">epiviz.ui.charts.decoration.ChartFilterCodeButton</a></li><li><a href="epiviz.ui.charts.decoration.ChartGroupByMeasurementsCodeButton.html">epiviz.ui.charts.decoration.ChartGroupByMeasurementsCodeButton</a></li><li><a href="epiviz.ui.charts.decoration.ChartLoaderAnimation.html">epiviz.ui.charts.decoration.ChartLoaderAnimation</a></li><li><a href="epiviz.ui.charts.decoration.ChartOptionButton.html">epiviz.ui.charts.decoration.ChartOptionButton</a></li><li><a href="epiviz.ui.charts.decoration.ChartOrderByMeasurementsCodeButton.html">epiviz.ui.charts.decoration.ChartOrderByMeasurementsCodeButton</a></li><li><a href="epiviz.ui.charts.decoration.ChartResize.html">epiviz.ui.charts.decoration.ChartResize</a></li><li><a href="epiviz.ui.charts.decoration.ChartTooltip.html">epiviz.ui.charts.decoration.ChartTooltip</a></li><li><a href="epiviz.ui.charts.decoration.CodeButton.html">epiviz.ui.charts.decoration.CodeButton</a></li><li><a href="epiviz.ui.charts.decoration.CustomSettingsButton.html">epiviz.ui.charts.decoration.CustomSettingsButton</a></li><li><a href="epiviz.ui.charts.decoration.EditCodeButton.html">epiviz.ui.charts.decoration.EditCodeButton</a></li><li><a href="epiviz.ui.charts.decoration.HierarchyFilterCodeButton.html">epiviz.ui.charts.decoration.HierarchyFilterCodeButton</a></li><li><a href="epiviz.ui.charts.decoration.MarkerCodeButton.html">epiviz.ui.charts.decoration.MarkerCodeButton</a></li><li><a href="epiviz.ui.charts.decoration.RemoveChartButton.html">epiviz.ui.charts.decoration.RemoveChartButton</a></li><li><a href="epiviz.ui.charts.decoration.SaveChartButton.html">epiviz.ui.charts.decoration.SaveChartButton</a></li><li><a href="epiviz.ui.charts.decoration.ToggleTooltipButton.html">epiviz.ui.charts.decoration.ToggleTooltipButton</a></li><li><a href="epiviz.ui.charts.decoration.VisualizationDecoration.html">epiviz.ui.charts.decoration.VisualizationDecoration</a></li><li><a href="epiviz.ui.charts.Margins.html">epiviz.ui.charts.Margins</a></li><li><a href="epiviz.ui.charts.markers.MeasurementAggregator.html">epiviz.ui.charts.markers.MeasurementAggregator</a></li><li><a href="epiviz.ui.charts.markers.VisualizationMarker.html">epiviz.ui.charts.markers.VisualizationMarker</a></li><li><a href="epiviz.ui.charts.Plot.html">epiviz.ui.charts.Plot</a></li><li><a href="epiviz.ui.charts.PlotType.html">epiviz.ui.charts.PlotType</a></li><li><a href="epiviz.ui.charts.Track.html">epiviz.ui.charts.Track</a></li><li><a href="epiviz.ui.charts.TrackType.html">epiviz.ui.charts.TrackType</a></li><li><a href="epiviz.ui.charts.transform.clustering.AgglomerativeClustering.html">epiviz.ui.charts.transform.clustering.AgglomerativeClustering</a></li><li><a href="epiviz.ui.charts.transform.clustering.ClusteringAlgorithmFactory.html">epiviz.ui.charts.transform.clustering.ClusteringAlgorithmFactory</a></li><li><a href="epiviz.ui.charts.transform.clustering.ClusterLeaf.html">epiviz.ui.charts.transform.clustering.ClusterLeaf</a></li><li><a href="epiviz.ui.charts.transform.clustering.ClusterSubtree.html">epiviz.ui.charts.transform.clustering.ClusterSubtree</a></li><li><a href="epiviz.ui.charts.transform.clustering.ClusterTree.html">epiviz.ui.charts.transform.clustering.ClusterTree</a></li><li><a href="epiviz.ui.charts.transform.clustering.CompleteLinkage.html">epiviz.ui.charts.transform.clustering.CompleteLinkage</a></li><li><a href="epiviz.ui.charts.transform.clustering.EuclideanMetric.html">epiviz.ui.charts.transform.clustering.EuclideanMetric</a></li><li><a href="epiviz.ui.charts.transform.clustering.NoneClustering.html">epiviz.ui.charts.transform.clustering.NoneClustering</a></li><li><a href="epiviz.ui.charts.tree.decoration.TogglePropagateSelectionButton.html">epiviz.ui.charts.tree.decoration.TogglePropagateSelectionButton</a></li><li><a href="epiviz.ui.charts.tree.HierarchyVisualization.html">epiviz.ui.charts.tree.HierarchyVisualization</a></li><li><a href="epiviz.ui.charts.tree.HierarchyVisualizationType.html">epiviz.ui.charts.tree.HierarchyVisualizationType</a></li><li><a href="epiviz.ui.charts.tree.Icicle.html">epiviz.ui.charts.tree.Icicle</a></li><li><a href="epiviz.ui.charts.tree.IcicleType.html">epiviz.ui.charts.tree.IcicleType</a></li><li><a href="epiviz.ui.charts.tree.Node.html">epiviz.ui.charts.tree.Node</a></li><li><a href="epiviz.ui.charts.tree.Sunburst.html">epiviz.ui.charts.tree.Sunburst</a></li><li><a href="epiviz.ui.charts.tree.UiNode.html">epiviz.ui.charts.tree.UiNode</a></li><li><a href="epiviz.ui.charts.VisEventArgs.html">epiviz.ui.charts.VisEventArgs</a></li><li><a href="epiviz.ui.charts.VisObject.html">epiviz.ui.charts.VisObject</a></li><li><a href="epiviz.ui.charts.Visualization.html">epiviz.ui.charts.Visualization</a></li><li><a href="epiviz.ui.charts.VisualizationProperties.html">epiviz.ui.charts.VisualizationProperties</a></li><li><a href="epiviz.ui.charts.VisualizationType.html">epiviz.ui.charts.VisualizationType</a></li><li><a href="epiviz.ui.ControlManager.html">epiviz.ui.ControlManager</a></li><li><a href="epiviz.ui.controls.CodeControl.html">epiviz.ui.controls.CodeControl</a></li><li><a href="epiviz.ui.controls.CodeDialog.html">epiviz.ui.controls.CodeDialog</a></li><li><a href="epiviz.ui.controls.ColorPickerDialog.html">epiviz.ui.controls.ColorPickerDialog</a></li><li><a href="epiviz.ui.controls.ComputedMeasurementsDialog.html">epiviz.ui.controls.ComputedMeasurementsDialog</a></li><li><a href="epiviz.ui.controls.Control.html">epiviz.ui.controls.Control</a></li><li><a href="epiviz.ui.controls.CustomSettingsDialog.html">epiviz.ui.controls.CustomSettingsDialog</a></li><li><a href="epiviz.ui.controls.DatasourceGroupWizardStep.html">epiviz.ui.controls.DatasourceGroupWizardStep</a></li><li><a href="epiviz.ui.controls.DataTable.html">epiviz.ui.controls.DataTable</a></li><li><a href="epiviz.ui.controls.DataTable.Column.html">epiviz.ui.controls.DataTable.Column</a></li><li><a href="epiviz.ui.controls.Dialog.html">epiviz.ui.controls.Dialog</a></li><li><a href="epiviz.ui.controls.EditCodeControl.html">epiviz.ui.controls.EditCodeControl</a></li><li><a href="epiviz.ui.controls.MarkerCodeControl.html">epiviz.ui.controls.MarkerCodeControl</a></li><li><a href="epiviz.ui.controls.MeaurementsWizardStep.html">epiviz.ui.controls.MeaurementsWizardStep</a></li><li><a href="epiviz.ui.controls.MessageDialog.html">epiviz.ui.controls.MessageDialog</a></li><li><a href="epiviz.ui.controls.SaveSvgAsImageDialog.html">epiviz.ui.controls.SaveSvgAsImageDialog</a></li><li><a href="epiviz.ui.controls.VisConfigSelection.html">epiviz.ui.controls.VisConfigSelection</a></li><li><a href="epiviz.ui.controls.Wizard.html">epiviz.ui.controls.Wizard</a></li><li><a href="epiviz.ui.LocationManager.html">epiviz.ui.LocationManager</a></li><li><a href="epiviz.ui.WebArgsManager.html">epiviz.ui.WebArgsManager</a></li><li><a href="epiviz.utils.IterableArray.html">epiviz.utils.IterableArray</a></li><li><a href="epiviz.workspaces.UserManager.html">epiviz.workspaces.UserManager</a></li><li><a href="epiviz.workspaces.Workspace.html">epiviz.workspaces.Workspace</a></li><li><a href="epiviz.workspaces.WorkspaceManager.html">epiviz.workspaces.WorkspaceManager</a></li></ul><h3>Interfaces</h3><ul><li><a href="epiviz.datatypes.deprecated.GenomicData.html">epiviz.datatypes.deprecated.GenomicData</a></li><li><a href="epiviz.datatypes.GenomicData.html">epiviz.datatypes.GenomicData</a></li><li><a href="epiviz.datatypes.GenomicData.RowItem.html">epiviz.datatypes.GenomicData.RowItem</a></li><li><a href="epiviz.datatypes.MeasurementGenomicData.html">epiviz.datatypes.MeasurementGenomicData</a></li><li><a href="epiviz.datatypes.Range.html">epiviz.datatypes.Range</a></li><li><a href="epiviz.ui.charts.transform.clustering.ClusteringLinkage.html">epiviz.ui.charts.transform.clustering.ClusteringLinkage</a></li><li><a href="epiviz.ui.charts.transform.clustering.ClusteringMetric.html">epiviz.ui.charts.transform.clustering.ClusteringMetric</a></li><li><a href="epiviz.ui.charts.transform.clustering.ClusterNode.html">epiviz.ui.charts.transform.clustering.ClusterNode</a></li><li><a href="epiviz.ui.charts.transform.clustering.HierarchicalClusteringAlgorithm.html">epiviz.ui.charts.transform.clustering.HierarchicalClusteringAlgorithm</a></li><li><a href="epiviz.ui.controls.Wizard.Step.html">epiviz.ui.controls.Wizard.Step</a></li><li><a href="epiviz.utils.Iterable.html">epiviz.utils.Iterable</a></li><li><a href="epiviz.utils.Iterator.html">epiviz.utils.Iterator</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Wed May 11 2016 13:52:40 GMT-0400 (EDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
